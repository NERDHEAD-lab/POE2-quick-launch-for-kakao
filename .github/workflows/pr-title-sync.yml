# PR ìƒì„± ì‹œ ë¸Œëœì¹˜ ì´ë¦„ì„ ê¸°ë°˜ìœ¼ë¡œ ì œëª©ì„ ìë™ ë³€í™˜í•©ë‹ˆë‹¤. (ë´‡ ì œì™¸)
# ë‹¨, ì‚¬ìš©ìê°€ ì´ë¯¸ ì œëª©ì„ ìˆ˜ìš©í•œ ê²½ìš°(ìµœê·¼ ì»¤ë°‹ ë©”ì‹œì§€ì™€ ì œëª©ì´ ë‹¤ë¥¸ ê²½ìš°)ëŠ” ê±´ë„ˆëœë‹ˆë‹¤.
name: PR Title Sync

on:
    pull_request:
        types: [opened]

jobs:
    sync-title:
        runs-on: ubuntu-latest
        if: github.event.pull_request.user.type != 'Bot'
        permissions:
            pull-requests: write
        steps:
            - name: Checkout
              uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
              with:
                  ref: ${{ github.event.pull_request.head.sha }}
                  fetch-depth: 0

            - name: Update PR Title
              env:
                  GH_TOKEN: ${{ github.token }}
                  BRANCH_NAME: ${{ github.event.pull_request.head.ref }}
                  PR_NUMBER: ${{ github.event.pull_request.number }}
                  PR_TITLE: ${{ github.event.pull_request.title }}
              run: |
                  LATEST_COMMIT_MSG=$(git log -1 --format=%s)

                  echo "ğŸ” Debug Info:"
                  echo "   - Current PR Title: '$PR_TITLE'"
                  echo "   - Latest Commit Msg: '$LATEST_COMMIT_MSG'"

                  if [[ "$PR_TITLE" != "$LATEST_COMMIT_MSG" ]]; then
                    echo "âš ï¸ PR Title mismatch detected."
                    echo "The PR title has likely been manually edited or does not match the initial commit."
                    echo "Skipping auto-rename to preserve user changes."
                    exit 0
                  fi

                  if [[ "$BRANCH_NAME" == *"/"* ]]; then
                    PREFIX="${BRANCH_NAME%%/*}"
                    SUFFIX="${BRANCH_NAME#*/}"
                    PREFIX_CAP="$(echo "${PREFIX:0:1}" | tr '[:lower:]' '[:upper:]')${PREFIX:1}"
                    SUFFIX_SPACE="$(echo "$SUFFIX" | sed 's/[-_]/ /g')"
                    NEW_TITLE="$PREFIX_CAP/$SUFFIX_SPACE"
                  else
                    NEW_TITLE="$(echo "${BRANCH_NAME:0:1}" | tr '[:lower:]' '[:upper:]')${BRANCH_NAME:1}"
                    NEW_TITLE="$(echo "$NEW_TITLE" | sed 's/[-_]/ /g')"
                  fi

                  echo "Setting PR title to: $NEW_TITLE"
                  gh pr edit "$PR_NUMBER" --title "$NEW_TITLE"
